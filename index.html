<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Tu endpoint de Apps Script -->
  <script>
    window.SHEETS_WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz7Ab7kQGgEd7XBbbCU6_hZuw11wXjq0dXd3l_RxLrp-QetqiD9tjBTY8dPTjWEuMd8/exec";
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bites & Vibes</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#faf4eb] text-[#3b2f2f]">

  <!-- Header -->
  <header class="sticky top-0 z-40 backdrop-blur bg-[#faf4eb]/80 border-b border-black/5">
    <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img src="Logo.png" alt="Logo Bites & Vibes" class="w-10 h-10 rounded-full border border-black/10" />
        <span class="font-black tracking-wide text-xl">Bites & Vibes</span>
      </div>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#menu" class="hover:opacity-80">Menú</a>
        <a href="#rastreo" class="hover:opacity-80">Rastreo</a>
        <a href="#como" class="hover:opacity-80">Cómo pedir</a>
        <a href="#nosotros" class="hover:opacity-80">Nosotros</a>
      </nav>
      <a href="https://wa.me/528132569289?text=Hola!%20Quiero%20pedir%20Bites%20%26%20Vibes%20🍫"
         class="rounded-2xl px-4 py-2 font-semibold bg-[#3b2f2f] text-white hover:opacity-90">
        Pedir por WhatsApp
      </a>
    </div>
  </header>

  <!-- Hero -->
  <section class="relative overflow-hidden">
    <div class="mx-auto max-w-6xl px-4 py-16 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-4xl md:text-5xl font-black leading-tight">
          Brownies & <span class="underline decoration-[#35d6c4] decoration-[6px] underline-offset-8">bites</span> hechos en MTY
        </h1>
        <p class="mt-4 text-[17px] opacity-80">
          Fudge húmedo, toppings deliciosos y vibes street. Perfectos para compartir o regalar.
        </p>
      </div>
      <img src="brownies.png" alt="Brownies Hero" class="rounded-3xl shadow-lg" />
    </div>
  </section>

  <!-- Menú -->
  <section id="menu" class="py-14 bg-white/70">
    <div class="mx-auto max-w-6xl px-4">
      <h2 class="text-2xl md:text-3xl font-extrabold mb-8">Menú</h2>
      <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">

        <!-- Fudge Brownies -->
        <article class="rounded-3xl p-4 border border-black/10 bg-white shadow-sm hover:shadow-lg transition">
          <img src="fudge-bites.png" alt="Fudge Brownies" class="w-full h-44 object-cover rounded-2xl" />
          <h3 class="mt-4 font-bold text-lg">Fudge Brownies</h3>
          <p class="text-sm opacity-80">Elige tamaño y sabor:</p>

          <!-- Tamaño -->
          <label class="mt-4 block text-sm font-medium">Tamaño</label>
          <select id="fudge-size" class="mt-2 w-full rounded-xl border p-2 bg-white">
            <option value="">Selecciona...</option>
            <option value="individual">Individual — $55</option>
            <option value="mediano">Mediano (6–8) — $166</option>
            <option value="grande">Grande (10–13) — $255</option>
          </select>

          <!-- Sabor -->
          <label class="mt-3 block text-sm font-medium">Sabor</label>
          <select id="fudge-sabor" class="mt-2 w-full rounded-xl border p-2 bg-white">
            <option value="">Selecciona...</option>
            <option value="Originales">Originales</option>
            <option value="Oreo">Oreo (+$20)</option>
            <option value="Nutella">Nutella (+$20)</option>
            <option value="Flan">Flan (+$15)</option>
            <option value="Mixto">Mixto</option>
            <option value="Sabor a elegir">Sabor a elegir (+$30)</option>
          </select>

          <!-- Cantidad -->
          <label class="mt-3 block text-sm font-medium">Cantidad</label>
          <input id="fudge-qty" type="number" min="1" value="1" class="mt-2 w-full rounded-xl border p-2 bg-white" />

          <button type="button" class="mt-4 w-full rounded-xl px-4 py-2 bg-[#35d6c4] font-semibold"
                  onclick="agregarFudge()">Agregar</button>
        </article>

        <!-- Brownie Bites -->
        <article class="rounded-3xl p-4 border border-black/10 bg-white shadow-sm hover:shadow-lg transition">
          <img src="choco-bites.png" alt="Brownie Bites" class="w-full h-44 object-cover rounded-2xl" />
          <h3 class="mt-4 font-bold text-lg">Brownie Bites</h3>
          <p class="text-sm opacity-80">Elige paquete y sabor:</p>

          <!-- Paquete -->
          <label class="mt-4 block text-sm font-medium">Paquete</label>
          <select id="bites-pack" class="mt-2 w-full rounded-xl border p-2 bg-white">
            <option value="">Selecciona...</option>
            <option value="3p">3 piezas — $77</option>
            <option value="6p">6 piezas — $111</option>
            <option value="9p">9 piezas — $166</option>
          </select>

          <!-- Sabor -->
          <label class="mt-3 block text-sm font-medium">Sabor</label>
          <select id="bites-sabor" class="mt-2 w-full rounded-xl border p-2 bg-white">
            <option value="">Selecciona...</option>
            <option value="Almendra">Almendra (+$15)</option>
            <option value="Nuez">Nuez (+$15)</option>
            <option value="Nutella">Nutella</option>
            <option value="Sabor a elegir">Sabor a elegir (+$30)</option>
          </select>

          <!-- Cantidad -->
          <label class="mt-3 block text-sm font-medium">Cantidad</label>
          <input id="bites-qty" type="number" min="1" value="1" class="mt-2 w-full rounded-xl border p-2 bg-white" />

          <button type="button" class="mt-4 w-full rounded-xl px-4 py-2 bg-[#35d6c4] font-semibold"
                  onclick="agregarBites()">Agregar</button>
        </article>

        <!-- Pack Regio -->
        <article class="rounded-3xl p-4 border border-black/10 bg-white shadow-sm hover:shadow-lg transition">
          <img src="pack-regio.png" alt="Pack Regio" class="w-full h-44 object-cover rounded-2xl" />
          <h3 class="mt-4 font-bold text-lg">Pack Regio</h3>
          <p class="text-sm opacity-80">3 Brownie Bites + 3 Fudge Brownies</p>
          <button type="button" class="mt-4 w-full rounded-xl px-4 py-2 bg-[#35d6c4] font-semibold"
                  onclick="agregarPack()">Agregar ($222)</button>
        </article>

      </div>
    </div>
  </section>

  <!-- Rastreo -->
  <section id="rastreo" class="py-14">
    <div class="mx-auto max-w-3xl px-4">
      <h2 class="text-2xl md:text-3xl font-extrabold mb-4">Rastrea tu pedido</h2>
      <p class="opacity-80 mb-4 text-sm">Escribe tu <strong>N° de orden</strong> (ej. BV-9F3K2T) para ver el estatus.</p>

      <div class="flex gap-3 flex-col sm:flex-row">
        <input id="track-order" type="text" placeholder="BV-XXXXXX"
              class="rounded-xl border border-black/15 p-3 bg-white w-full sm:w-64 uppercase tracking-wider" />
        <button type="button" onclick="rastrearPedido()"
                class="rounded-xl px-4 py-3 bg-[#35d6c4] font-semibold hover:opacity-90 w-full sm:w-auto">
          Consultar estatus
        </button>
      </div>

      <div id="track-result" class="mt-5 hidden">
        <div class="rounded-2xl border border-black/10 bg-white p-4">
          <p class="text-sm"><span class="font-semibold">Orden:</span> <span id="tr-orden"></span></p>
          <p class="text-sm"><span class="font-semibold">Cliente:</span> <span id="tr-cliente"></span></p>
          <p class="text-sm"><span class="font-semibold">Fecha de entrega:</span> <span id="tr-fecha"></span></p>
          <p class="text-sm"><span class="font-semibold">Estatus:</span>
            <span id="tr-status" class="inline-block rounded-full px-2 py-0.5 text-xs bg-black/5"></span>
          </p>
          <p class="text-sm mt-2"><span class="font-semibold">Total:</span> <span id="tr-total"></span></p>
          <div class="mt-3">
            <p class="font-semibold text-sm mb-2">Productos:</p>
            <ul id="tr-items" class="text-sm list-disc pl-5 space-y-1"></ul>
          </div>
        </div>
      </div>

      <p id="track-error" class="mt-4 text-sm text-red-600 hidden"></p>
    </div>
  </section>

  <!-- Cómo pedir -->
  <section id="como" class="py-16">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-3 gap-6">
      <div class="rounded-3xl border border-black/10 bg-white p-6">
        <h4 class="font-bold text-lg">1. Elige tus bites</h4>
        <p class="text-sm opacity-80">Selecciona tamaños/paquetes, sabores y cantidad.</p>
      </div>
      <div class="rounded-3xl border border-black/10 bg-white p-6">
        <h4 class="font-bold text-lg">2. Escríbenos</h4>
        <p class="text-sm opacity-80">Haz clic en WhatsApp y envíanos tu pedido.</p>
      </div>
      <div class="rounded-3xl border border-black/10 bg-white p-6">
        <h4 class="font-bold text-lg">3. Disfruta</h4>
        <p class="text-sm opacity-80">Entregas en Monterrey y área metropolitana.</p>
      </div>
    </div>
  </section>

  <!-- Nosotros -->
  <section id="nosotros" class="py-16 bg-white/60">
    <div class="max-w-6xl mx-auto px-4 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h3 class="text-2xl md:text-3xl font-extrabold">Hechos con amor regio 🤘</h3>
        <p class="mt-3 opacity-80">
          Bites & Vibes nace en Monterrey con una idea simple: Brownies y brownie bites con GRAN sabor. Usamos cacao real y recetas probadas para lograr textura fudge y toppings crujientes.
        </p>
      </div>
      <img src="nosotros.png" alt="Nosotros" class="rounded-3xl shadow-md" />
    </div>
  </section>
  
  <!-- Footer -->
  <footer class="py-10">
    <div class="mx-auto max-w-6xl px-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-6 items-center">
      <div class="flex items-center gap-3">
        <img src="Logo.png" alt="Logo Bites & Vibes" class="w-8 h-8 rounded-full border border-black/10" />
        <div>
          <p class="font-black">Bites & Vibes</p>
          <p class="text-sm opacity-70">Monterrey, N.L. 🇲🇽</p>
        </div>
      </div>
      <div class="text-sm opacity-80">
        <p>Pedidos: Lun–Vie 09:00–20:00</p>
        <p>DM Instagram / WhatsApp</p>
      </div>
      <div class="flex gap-3 justify-start lg:justify-end">
        <a href="https://wa.me/528132569289?text=Hola!%20Vengo%20de%20tu%20página%20web%20✨"
           class="rounded-xl px-4 py-2 bg-[#35d6c4] font-semibold">WhatsApp</a>
        <a href="https://www.instagram.com/bitesvibes.mty/" target="_blank"
          class="rounded-xl px-4 py-2 border border-black/15 hover:bg-black/5">Instagram</a>
      </div>
    </div>
    <p class="text-center text-xs opacity-50 mt-6">© 2025 Bites & Vibes. Todos los derechos reservados.</p>
  </footer>

  <!-- Carrito / Total (pegajoso) -->
  <div id="cartbar" class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-black/10 p-4 z-50">
    <div class="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-start md:items-center gap-3">
      <!-- Datos opcionales del cliente -->
      <div class="w-full md:w-auto flex flex-col sm:flex-row gap-2">
        <input id="cliente-nombre" type="text" placeholder="Tu nombre (opcional)"
               class="rounded-xl border border-black/15 p-2 bg-white w-full sm:w-64" />
        <input id="cliente-fecha" type="date" placeholder="Fecha de entrega (opcional)"
               class="rounded-xl border border-black/15 p-2 bg-white w-full sm:w-56" />
      </div>

      <!-- Items -->
      <div id="cart-items" class="text-sm opacity-60 w-full md:w-auto">Tu pedido aparecerá aquí…</div>

      <!-- Total + enviar -->
      <div class="flex gap-4 items-center w-full md:w-auto justify-between md:justify-end">
        <div id="cart-total" class="font-bold text-lg">$0 MXN</div>
        <button onclick="enviarPedido()" class="rounded-xl px-4 py-2 bg-[#3b2f2f] text-white hover:opacity-90">Enviar pedido</button>
      </div>
    </div>
  </div>

  <!-- Scripts principales -->
  <script>
    const WHATSAPP_NUMBER = "528132569289";

    // Precios base
    const PRICES = {
      fudge: { individual: 55, mediano: 166, grande: 255 },
      bites: { "3p": 77, "6p": 111, "9p": 166 },
      pack: 222
    };
    
    // Costos extra por sabor
    const EXTRA_PRICES = {
      fudge: {
        "Oreo": 20,
        "Nutella": 20,
        "Flan": 15,
        "Sabor a elegir": 30,
        "Originales": 0,
        "Mixto": 0
      },
      bites: {
        "Almendra": 15,
        "Nuez": 15,
        "Sabor a elegir": 30,
        "Nutella": 0
      }
    };
    
    const cart = [];
    const fmt = n => `$${Number(n||0).toLocaleString('es-MX')} MXN`;

    function agregarFudge(){
      const size = document.getElementById('fudge-size').value;
      const sabor = document.getElementById('fudge-sabor').value;
      const qty = parseInt(document.getElementById('fudge-qty').value,10);
      if(!size || !sabor || qty<1) return alert("Completa tamaño, sabor y cantidad");

      const base = PRICES.fudge[size];
      const extra = EXTRA_PRICES.fudge[sabor] || 0;
      const unit = base + extra;

      cart.push({
        producto:"Fudge Brownies",
        variante:size,
        sabor,
        qty,
        unit,
        subtotal: unit*qty
      });
      renderCart();
    }

    function agregarBites(){
      const pack = document.getElementById('bites-pack').value;
      const sabor = document.getElementById('bites-sabor').value;
      const qty = parseInt(document.getElementById('bites-qty').value,10);
      if(!pack || !sabor || qty<1) return alert("Completa paquete, sabor y cantidad");

      const base = PRICES.bites[pack];
      const extra = EXTRA_PRICES.bites[sabor] || 0;
      const unit = base + extra;

      cart.push({
        producto:"Brownie Bites",
        variante:pack,  // 3p/6p/9p
        sabor,
        qty,
        unit,
        subtotal: unit*qty
      });
      renderCart();
    }

    function agregarPack(){
      const unit = PRICES.pack;
      cart.push({
        producto:"Pack Regio",
        variante:"combo",
        sabor:"-",
        qty:1,
        unit,
        subtotal: unit
      });
      renderCart();
    }

    function renderCart(){
      const cont = document.getElementById('cart-items');
      if(cart.length===0){
        cont.textContent="Tu pedido aparecerá aquí…";
        document.getElementById('cart-total').textContent="$0 MXN";
        return;
      }
      cont.innerHTML = cart.map((it,i)=>`
        <div class="mb-1">
          ${it.producto}${it.variante ? ' ('+it.variante+')':''}
          ${it.sabor!=="-"? ' — '+it.sabor:''}
          — x${it.qty}
          = <span class="font-semibold">${fmt(it.subtotal)}</span>
          <button onclick="cart.splice(${i},1);renderCart()" class="ml-2 text-xs underline">Quitar</button>
        </div>
      `).join("");
      const total = cart.reduce((s,it)=>s+it.subtotal,0);
      document.getElementById('cart-total').textContent = fmt(total);
    }

    // Generar un Order ID (ej. BV-9F3K2T)
    function generarOrderId(){
      return 'BV-' + Math.random().toString(36).slice(2, 8).toUpperCase();
    }

    async function enviarPedido(){
      if(cart.length===0) return alert("Carrito vacío");

      const orderId = generarOrderId();
      const total = cart.reduce((s,it)=>s+it.subtotal,0);
      const nombre = (document.getElementById('cliente-nombre')?.value || '').trim();
      const fecha  = (document.getElementById('cliente-fecha')?.value || '').trim();

      // Mensaje de WhatsApp
      let msg = `Hola Bites & Vibes! Quiero pedir (N° de orden: ${orderId}):\n`;
      cart.forEach(it=>{
        msg += `• ${it.producto}${it.variante?` (${it.variante})`:''}${(it.sabor && it.sabor!=='-') ? ' — Sabor: '+it.sabor : ''} — Cantidad: ${it.qty} — Subtotal: ${fmt(it.subtotal)}\n`;
      });
      msg += `\nTotal: ${fmt(total)}`;
      if (nombre) msg += `\nNombre: ${nombre}`;
      if (fecha)  msg += `\nFecha de entrega deseada: ${fecha}`;
      msg += `\n¿Me confirmas tiempo de entrega y total?`;

      // Abrir WhatsApp
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg)}`,"_blank");

      // Registrar en Google Sheets
      try {
        const endpoint = window.SHEETS_WEBAPP_URL || "";
        if (endpoint){
          const payload = {
            timestamp: new Date().toISOString(),
            source: "web",
            total,
            order_id: orderId,
            cliente: nombre,
            contacto: "WhatsApp",
            fecha_entrega: fecha,
            status: "Pendiente",
            items: cart.map(it => ({
              producto: it.producto,
              variante: it.variante || "",
              sabor: it.sabor,
              cantidad: it.qty,
              unit: it.unit,
              subtotal: it.subtotal
            }))
          };

          await fetch(endpoint, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        }
      } catch (e){
        console.log('No se pudo registrar en la hoja:', e);
      }
    }

    // RASTREO
    async function rastrearPedido(){
      const order = (document.getElementById('track-order').value || '').trim().toUpperCase();
      const errorEl = document.getElementById('track-error');
      const wrap = document.getElementById('track-result');
      errorEl.classList.add('hidden');
      wrap.classList.add('hidden');

      if (!order) {
        errorEl.textContent = 'Escribe tu número de orden.';
        errorEl.classList.remove('hidden');
        return;
      }
      try {
        const res = await fetch(`${window.SHEETS_WEBAPP_URL}?order=${encodeURIComponent(order)}`);
        const data = await res.json();
        if (!data.ok) {
          errorEl.textContent = data.error || 'Orden no encontrada.';
          errorEl.classList.remove('hidden');
          return;
        }
        document.getElementById('tr-orden').textContent  = data.order_id || order;
        document.getElementById('tr-cliente').textContent = data.cliente || '—';
        document.getElementById('tr-fecha').textContent   = data.fecha_entrega || '—';
        document.getElementById('tr-status').textContent  = data.status || 'Pendiente';
        document.getElementById('tr-total').textContent   = fmt(data.total || 0);

        const ul = document.getElementById('tr-items');
        ul.innerHTML = '';
        (data.items || []).forEach(it => {
          const li = document.createElement('li');
          const varTxt = it.variante ? ` (${it.variante})` : '';
          const sabTxt = it.sabor ? ` — Sabor: ${it.sabor}` : '';
          li.textContent = `${it.producto}${varTxt}${sabTxt} — x${it.cantidad} — Subtotal: ${fmt(it.subtotal)}`;
          ul.appendChild(li);
        });

        wrap.classList.remove('hidden');
      } catch (err){
        errorEl.textContent = 'Error consultando el estatus. Intenta de nuevo.';
        errorEl.classList.remove('hidden');
        console.log(err);
      }
    }
  </script>

</body>
</html>
